{% extends "base.html" %}
{% block content %}
<h1>Relatório de lucro por produto</h1>

<p class="small">
  Margem já considera a comissão. Neste relatório também são descontados:
  imposto ({{ '%.2f'|format(imposto_percent) }}%) e despesas ({{ '%.2f'|format(despesas_percent) }}%).
</p>

<table>
  <thead>
    <tr>
      <th>Produto</th>
      <th>Qtd. vendida</th>
      <th>Receita (R$)</th>
      <th>Custo (R$)</th>
      <th>Margem (R$)</th>
      <th>Impostos (R$)</th>
      <th>Despesas (R$)</th>
      <th>Lucro líquido (R$)</th>
      <th>Margem (%)</th>
    </tr>
  </thead>
  <tbody>
    {% for l in linhas %}
    {% set receita = l['receita'] or 0 %}
    {% set margem = l['margem'] or 0 %}
    <tr>
      <td>{{ l['nome'] }}</td>
      <td>{{ l['qtd'] }}</td>
      <td>{{ '%.2f'|format(receita) }}</td>
      <td>{{ '%.2f'|format(l['custo'] or 0) }}</td>
      <td>{{ '%.2f'|format(margem) }}</td>
      <td>{{ '%.2f'|format(l['impostos'] or 0) }}</td>
      <td>{{ '%.2f'|format(l['despesas'] or 0) }}</td>
      <td>{{ '%.2f'|format(l['lucro_liquido'] or 0) }}</td>
      <td>
        {% if receita > 0 %}
          {{ '%.2f'|format((l['lucro_liquido'] / receita) * 100) }}%
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr>
      <th>TOTAIS</th>
      <th>{{ totais['qtd'] }}</th>
      <th>{{ '%.2f'|format(totais['receita'] or 0) }}</th>
      <th>{{ '%.2f'|format(totais['custo'] or 0) }}</th>
      <th>{{ '%.2f'|format(totais['margem'] or 0) }}</th>
      <th>{{ '%.2f'|format(totais['impostos'] or 0) }}</th>
      <th>{{ '%.2f'|format(totais['despesas'] or 0) }}</th>
      <th>{{ '%.2f'|format(totais['lucro_liquido'] or 0) }}</th>
      <th>
        {% if totais['receita'] > 0 %}
          {{ '%.2f'|format((totais['lucro_liquido'] / totais['receita']) * 100) }}%
        {% else %}
          -
        {% endif %}
      </th>
    </tr>
  </tfoot>
</table>
{% endblock %}
